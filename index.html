<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üê∞ C9 1ÌöåÏ∞® ÎÇ≠ÌîåÎã®</title>

<style>
body {
    background: #FFF6FA;
    font-family: "Pretendard", -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
    display: flex;
    justify-content: center;
    padding: 20px 16px;
    margin: 0;
    color: #4c2d3b;
}
.wrap {
    width: 100%;
    max-width: 1080px;
    margin: 0 auto;
}
h1 {
    text-align: center;
    font-size: 22px;
    font-weight: 800;
    margin-bottom: 12px;
    color: #FF8FB2;
}
.filter-bar {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-bottom: 12px;
    font-size: 13px;
}
.filter-bar input {
    flex: 1;
    max-width: 260px;
    padding: 6px 10px;
    border-radius: 999px;
    border: 1px solid #ffd6ea;
    background: #FFF9FD;
    outline: none;
}
.filter-bar input:focus {
    border-color: #ff9fc7;
    box-shadow: 0 0 0 2px rgba(255,159,199,0.25);
}
.table-scroll {
    overflow-x: auto;
    padding-bottom: 4px;
}
.table {
    display: flex;
    flex-direction: column;
    gap: 4px;
    min-width: 760px;
}
.row {
    display: flex;
    background: white;
    border-radius: 24px;
    overflow: hidden;
    box-shadow: 0 1px 4px rgba(255,150,180,0.08);
    padding: 2px 0;
    transition: box-shadow 0.15s ease, transform 0.15s ease;
}
.data-row:hover {
    box-shadow: 0 3px 8px rgba(255,150,180,0.18);
    transform: translateY(-1px);
}
.cell {
    padding: 4px 8px;
    font-size: 14px;
    display: inline-flex;
    justify-content: center;
    align-items: center;
    text-align: center;
    border-right: 1px solid #FFE1EF;
    outline: none;
    cursor: text;
    white-space: normal;
    word-break: keep-all;
}
.cell:last-child {
    border-right: none;
}
.header {
    background: #FFEFF7;
}
.header .cell {
    font-weight: 700;
    color: #D04F7D;
    border-bottom: 2px solid #F8C7DB;
    contenteditable: false;
    cursor: default;
}
.summary-row {
    background: #FFF9FD;
    font-weight: 700;
    color: #cc507a;
}

/* üîπ Ïó¥Î≥Ñ Í≥†Ï†ï ÎÑàÎπÑ */
.row .cell:nth-child(1) { width: 130px; }   /* ÏïÑÏù¥Îîî */
.row .cell:nth-child(2) { width: 130px; }   /* ÎãâÎÑ§ÏûÑ */
.row .cell:nth-child(3) { width: 90px; }   /* ÎÇ≠Ìîå */
.row .cell:nth-child(4) { width: 80px; }   /* ÏõêÌîåÏõê */
.row .cell:nth-child(5) { width: 430px; }   /* Í≥µÏïΩ */
.row .cell:nth-child(6) { width: 80px; }   /* Ïó≠Ìå¨ */
.row .cell:nth-child(7) { width: 60px; }   /* ÎπÑÍ≥† */
.row .cell:nth-child(8) { width: 80px; }    /* Î≤ÑÌäº */

/* üîπ Î≤ÑÌäº */
.action-cell {
    position: relative;
    cursor: default;
    border-right: none;
}
.action-buttons {
    display: none;
    gap: 4px;
    position: absolute;
    right: 4px;
    top: 50%;
    transform: translateY(-50%);
}
.action-buttons button {
    background: #FFD8EA;
    border: none;
    border-radius: 999px;
    padding: 3px 7px;
    font-size: 11px;
    cursor: pointer;
    color: #D24E78;
    transition: background 0.15s ease, transform 0.15s ease, box-shadow 0.15s ease;
}
.action-buttons button:hover {
    background: #ffbddc;
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(255,150,180,0.35);
}
.row.show-actions .action-buttons {
    display: flex;
}

/* üîπ ÏÉâÏÉÅ Îã®Í≥Ñ */
:root {
    --lv0: #FFFFFF;
    --lv1: #FFF9FD;
    --lv2: #FFF3FA;
    --lv3: #FFE9F4;
    --lv4: #FFE0EF;
    --lv5: #FFD7EB;
    --lv6: #FFCEE7;
    --lv7: #FFC6E3;
    --lv8: #FFBEDF;
    --lv9: #FFB6DA;
}
.ygp-cell.manual { background: #F1E8FF; }

</style>
</head>

<body>
<div class="wrap">

    <h1>üê∞ C9 1ÌöåÏ∞® ÎÇ≠ÌîåÎã®</h1>

    <div class="filter-bar">
        <input id="search" type="text" placeholder="ÏïÑÏù¥Îîî / ÎãâÎÑ§ÏûÑ Í≤ÄÏÉâ">
    </div>

    <div class="table-scroll">
        <div class="table" id="table">

            <!-- (üí° Ïó¨Í∏∞Ïóê ÎÑàÍ∞Ä Í∞ÄÏßÄÍ≥† ÏûàÎäî Í∏∞Ï°¥ Î™®Îì† row Í∑∏ÎåÄÎ°ú Ïú†ÏßÄ) -->

            <!-- ‚àö Ìï©Í≥Ñ Ìñâ -->
            <div class="row summary-row">
                <div class="cell">Ìï©Í≥Ñ</div>
                <div class="cell"></div>
                <div class="cell summary-amount"></div>
                <div class="cell"></div>
                <div class="cell"></div>
                <div class="cell summary-ygp"></div>
                <div class="cell"></div>
                <div class="cell"></div>
            </div>

        </div>
    </div>
</div>


<script>
/* === 1. Ìñâ Ïä§ÌÉÄÏùº + ÏûêÎèô Ïó≠Ìå¨ === */
function applyRowStyle(row){
    const amountCell = row.querySelector(".amount-cell");
    const ygpCell = row.querySelector(".ygp-cell");
    if(!amountCell || !ygpCell) return;

    const num = parseInt(amountCell.innerText.replace(/[^0-9]/g,'')) || 0;

    if (ygpCell.dataset.auto !== "false") {
        ygpCell.innerText = num > 0 ? Math.round(num * 0.03) : "";
        ygpCell.dataset.auto = "true";
        ygpCell.classList.remove("manual");
    }

    let lv="--lv0";
    if(num >=100 && num<=298) lv="--lv1";
    else if(num<=999) lv="--lv2";
    else if(num<=2999) lv="--lv3";
    else if(num<=4999) lv="--lv4";
    else if(num<=9999) lv="--lv5";
    else if(num<=49999) lv="--lv6";
    else if(num<=99999) lv="--lv7";
    else if(num<=299999) lv="--lv8";
    else if(num>=300000) lv="--lv9";

    row.style.background = `var(${lv})`;
}

/* === 2. Ìï©Í≥Ñ === */
function updateSummary(){
    const sumAmountCell = document.querySelector(".summary-amount");
    const sumYgpCell    = document.querySelector(".summary-ygp");
    let sumAmount = 0, sumYgp = 0;

    document.querySelectorAll(".data-row").forEach(row=>{
        const a = parseInt(row.querySelector(".amount-cell").innerText.replace(/[^0-9]/g,'')) || 0;
        const y = parseInt(row.querySelector(".ygp-cell").innerText.replace(/[^0-9]/g,'')) || 0;
        sumAmount += a;
        sumYgp    += y;
    });

    sumAmountCell.innerText = sumAmount;
    sumYgpCell.innerText = sumYgp;
}

/* === Ï†ÑÏ≤¥ Í∞±Ïã† === */
function refreshAll(){
    document.querySelectorAll(".data-row").forEach(applyRowStyle);
    updateSummary();
}

/* === 3. Ìñâ Î≤ÑÌäº ÌëúÏãú === */
document.addEventListener("click", (e)=>{
    const clickedRow = e.target.closest(".data-row");
    document.querySelectorAll(".data-row").forEach(r=>r.classList.remove("show-actions"));
    if(clickedRow) clickedRow.classList.add("show-actions");

    if (!e.target.closest(".cell")) {
        const active = document.activeElement;
        if (active && active.classList.contains("cell")) active.blur();
    }
});

/* === 4. Ìñâ Ï∂îÍ∞Ä/ÏÇ≠Ï†ú === */
function addRow(after){
    const newRow = after.cloneNode(true);
    newRow.querySelectorAll(".cell").forEach(c=>{
        if(!c.classList.contains("action-cell")) c.innerText = "";
        if(c.classList.contains("ygp-cell")){
            c.dataset.auto = "true";
            c.classList.remove("manual");
        }
    });
    after.insertAdjacentElement("afterend", newRow);
    refreshAll();
}

function deleteRow(row){
    if(document.querySelectorAll(".data-row").length <= 1){
        alert("ÎßàÏßÄÎßâ ÌñâÏùÄ ÏÇ≠Ï†úÌï† Ïàò ÏóÜÏäµÎãàÎã§.");
        return;
    }
    row.remove();
    refreshAll();
}

document.addEventListener("click", (e)=>{
    if(e.target.classList.contains("add")) addRow(e.target.closest(".data-row"));
    if(e.target.classList.contains("del")) deleteRow(e.target.closest(".data-row"));
});

/* === 5. Í≤ÄÏÉâ === */
document.getElementById("search").addEventListener("input", e=>{
    const q = e.target.value.trim().toLowerCase();

    document.querySelectorAll(".data-row").forEach(row=>{
        const id   = row.children[0].innerText.toLowerCase();
        const nick = row.children[1].innerText.toLowerCase();
        row.style.display = (!q || id.includes(q) || nick.includes(q)) ? "flex" : "none";
    });
});

/* === 6. ÏûÖÎ†• ‚Üí Ïó≠Ìå¨ ÏûêÎèô/ÏàòÎèô Ï≤òÎ¶¨ === */
document.addEventListener("input", (e)=>{
    const row = e.target.closest(".data-row");
    if(!row) return;

    const ygpCell = row.querySelector(".ygp-cell");

    if (e.target === ygpCell) {
        ygpCell.dataset.auto = "false";
        ygpCell.classList.add("manual");
    }

    refreshAll();
});

/* Ï¥àÍ∏∞ Ïã§Ìñâ */
window.onload = refreshAll;
</script>

</body>
</html>
