<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ğŸ° C9 1íšŒì°¨ ë‚­í”Œë‹¨</title>

<style>
body {
    background: #FFF7F1;
    font-family: "Pretendard", system-ui, sans-serif;
    display: flex;
    justify-content: center;
    padding: 40px 16px;
    color: #5b3b3b;
}

.wrap {
    width: 100%;
    max-width: 900px;
}

/* ì œëª© */
h1 {
    text-align: center;
    margin-bottom: 16px;
    color: #FF9DB5;
    font-weight: 800;
    font-size: 20px;
}

/* í…Œì´ë¸” ë˜í¼ */
.table {
    display: flex;
    flex-direction: column;
    gap: 10px; /* í–‰ê³¼ í–‰ ì‚¬ì´ ê°„ê²© */
}

/* í–‰ â€“ ì–‘ë ë‘¥ê¸€ê²Œ */
.row {
    display: grid;
    grid-template-columns: 1.1fr 1.2fr 1fr 1fr 1.4fr 1fr 1.4fr;
    background: white;
    border-radius: 14px; /* ëª¨ì„œë¦¬ ë” ë‘¥ê¸€ê²Œ */
    overflow: hidden;
}

/* ì…€ */
.cell {
    padding: 6px 6px;
    font-size: 13px;
    border-right: 1px solid #ffd9eb;
    border-bottom: 1px solid #ffd9eb;
    text-align: center;
    outline: none;
    contenteditable: plaintext-only; /* í…ìŠ¤íŠ¸ë§Œ */
    white-space: nowrap;             /* ì¤„ë°”ê¿ˆ ê¸ˆì§€ */
    user-select: text;               /* í…ìŠ¤íŠ¸ ì„ íƒ ê°€ëŠ¥ */
}

/* ë§ˆì§€ë§‰ ì…€ ì˜¤ë¥¸ìª½ì„  ì œê±° */
.cell:last-child {
    border-right: none;
}

/* í—¤ë” ìŠ¤íƒ€ì¼ */
.header .cell {
    background: #FFE9F3;
    color: #D05B87;
    font-weight: 700;
    border-bottom: 2px solid #f5bad2;
    contenteditable: false; /* í—¤ë”ëŠ” ìˆ˜ì • ë¶ˆê°€ */
}

/* ì„ íƒ ê°•ì¡° (ë‚˜ì¤‘ì— ì“°ê³  ì‹¶ì„ ìˆ˜ë„ ìˆì–´ì„œ ë‚¨ê¹€) */
.row.selected {
    outline: 2px solid #ff8aba;
}

/* ìƒ‰ìƒ íŒ”ë ˆíŠ¸ (í–‰ ë°°ê²½) */
:root {
    --lv0: #FFFFFF;  /* 0~99 ì•„ë¬´ê²ƒë„ ì•„ë‹˜ */
    --lv1: #FFF6FB;  /* 100~298 */
    --lv2: #FFEFF7;  /* 299~999 */
    --lv3: #FFE6F3;  /* 1000~2999 */
    --lv4: #FFDEEF;  /* 3000~4999 */
    --lv5: #FFD5EB;  /* 5000~9999 */
    --lv6: #FFCDE6;  /* 10000~49999 */
    --lv7: #FFC5E2;  /* 50000~99999 */
    --lv8: #FFBCD9;  /* 100000~299999 */
    --lv9: #FFB2D0;  /* 300000~ */
}

/* ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ (ìœ„/ì•„ë˜ í–‰ ì‚½ì…/ì‚­ì œ) */
.context-menu {
    position: absolute;
    background: white;
    border: 1px solid #e4b7cc;
    border-radius: 10px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.12);
    padding: 6px;
    z-index: 9999;
    font-size: 14px;
    min-width: 140px;
}
.context-menu div {
    padding: 8px 10px;
    color: #d94872;
    text-align: center;
}
.context-menu div:hover {
    background: #ffe6f1;
    cursor: pointer;
}
</style>
</head>
<body>
<div class="wrap">

    <h1>ğŸ° C9 1íšŒì°¨ ë‚­í”Œë‹¨</h1>

    <div class="table" id="nang-table">

        <!-- í—¤ë” -->
        <div class="row header">
            <div class="cell">ì•„ì´ë””</div>
            <div class="cell">ë‹‰ë„¤ì„</div>
            <div class="cell">ê°¯ìˆ˜</div>
            <div class="cell">ì›í”Œì›</div>
            <div class="cell">ê³µì•½</div>
            <div class="cell">ì—­íŒ¬</div>
            <div class="cell">ë¹„ê³ </div>
        </div>

        <!-- ìƒ˜í”Œ ë°ì´í„° 1ì¤„ (ë³µì‚¬í•´ì„œ ì“°ë©´ ë¨) -->
        <div class="row data-row">
            <div class="cell">danggun</div>
            <div class="cell">ë‹¹êµ°</div>
            <div class="cell amount-cell">30000</div>
            <div class="cell">1</div>
            <div class="cell">ì¶œì„</div>
            <div class="cell ygp-cell"></div>
            <div class="cell">VIP</div>
        </div>

    </div>
</div>

<script>
const isMobile = 'ontouchstart' in window;

/* -----------------------------
 ê°¯ìˆ˜ì— ë”°ë¥¸ ìƒ‰ìƒ + ì—­íŒ¬ 3% ê³„ì‚°
----------------------------- */
function applyRowStyle(row) {
    const amountCell = row.querySelector(".amount-cell");
    const ygpCell    = row.querySelector(".ygp-cell");
    if (!amountCell || !ygpCell) return;

    const num = parseInt(amountCell.innerText.replace(/[^0-9]/g, ""), 10) || 0;

    // 3% ì—­íŒ¬ (ë°˜ì˜¬ë¦¼)
    ygpCell.innerText = num > 0 ? Math.round(num * 0.03) : "";

    let levelVar = "--lv0";
    if (num >= 100 && num <= 298)       levelVar = "--lv1";
    else if (num >= 299 && num <= 999)  levelVar = "--lv2";
    else if (num >= 1000 && num <= 2999)   levelVar = "--lv3";
    else if (num >= 3000 && num <= 4999)   levelVar = "--lv4";
    else if (num >= 5000 && num <= 9999)   levelVar = "--lv5";
    else if (num >= 10000 && num <= 49999) levelVar = "--lv6";
    else if (num >= 50000 && num <= 99999) levelVar = "--lv7";
    else if (num >= 100000 && num <= 299999) levelVar = "--lv8";
    else if (num >= 300000)              levelVar = "--lv9";

    row.style.background = `var(${levelVar})`;
}

/* í…Œì´ë¸” ì „ì²´ ë‹¤ì‹œ ê³„ì‚° */
function refreshAllRows() {
    document.querySelectorAll(".row.data-row").forEach(applyRowStyle);
}

/* -----------------------------
 í–‰ ì‚½ì… / ì‚­ì œ
----------------------------- */
function createEmptyRow() {
    const row = document.createElement("div");
    row.className = "row data-row";
    row.innerHTML = `
        <div class="cell"></div>
        <div class="cell"></div>
        <div class="cell amount-cell">0</div>
        <div class="cell"></div>
        <div class="cell"></div>
        <div class="cell ygp-cell"></div>
        <div class="cell"></div>
    `;
    return row;
}

function insertRow(baseRow, position) {
    const table = document.getElementById("nang-table");
    const newRow = createEmptyRow();

    if (position === "above") {
        table.insertBefore(newRow, baseRow);
    } else {
        table.insertBefore(newRow, baseRow.nextSibling);
    }
    applyRowStyle(newRow);
}

/* ì„ íƒëœ í–‰ ì‚­ì œ â€“ ìµœì†Œ 1ì¤„ ë‚¨ê¸°ëŠ” ê±´ ì›í•˜ë©´ ì¶”ê°€ ê°€ëŠ¥ */
function deleteRow(row) {
    row.remove();
}

/* -----------------------------
 ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ ìƒì„±
----------------------------- */
function showContextMenu(event, row) {
    // ê¸°ì¡´ ë©”ë‰´ ì œê±°
    document.querySelectorAll(".context-menu").forEach(el => el.remove());

    const menu = document.createElement("div");
    menu.className = "context-menu";

    const x = (event.clientX || event.touches?.[0].clientX || 0) + 130;
    const y = (event.clientY || event.touches?.[0].clientY || 0) - 10;

    menu.style.left = x + "px";
    menu.style.top  = y + "px";

    menu.innerHTML = `
        <div onclick="insertRow(window._ctxRow,'above')">â–² ìœ„ì— í–‰ ì‚½ì…</div>
        <div onclick="insertRow(window._ctxRow,'below')">â–¼ ì•„ë˜ í–‰ ì‚½ì…</div>
        <div onclick="deleteRow(window._ctxRow)">ğŸ—‘ í–‰ ì‚­ì œ</div>
    `;

    window._ctxRow = row;
    document.body.appendChild(menu);
}

/* -----------------------------
 ì´ë²¤íŠ¸ ë°”ì¸ë”©
----------------------------- */
const table = document.getElementById("nang-table");

/* ì…ë ¥ ë°œìƒ ì‹œ â€“ ê°¯ìˆ˜ ì¹¸ ë³€ê²½ ê°ì§€í•´ì„œ ìŠ¤íƒ€ì¼ ë‹¤ì‹œ ì ìš© */
table.addEventListener("input", (e) => {
    const row = e.target.closest(".row.data-row");
    if (!row) return;
    // ê°¯ìˆ˜ ì¹¸ì´ ì•„ë‹ˆì–´ë„, ê·¸ëƒ¥ í•´ë‹¹ ì¤„ë§Œ ë§¤ë²ˆ ë‹¤ì‹œ ê³„ì‚°
    applyRowStyle(row);
});

/* PC â€“ ìš°í´ë¦­ ì‹œ ë©”ë‰´ ë„ìš°ê¸° (ê¸°ë³¸ ë©”ë‰´ë„ ê·¸ëŒ€ë¡œ ë†”ë‘ ) */
table.addEventListener("contextmenu", (e) => {
    const row = e.target.closest(".row.data-row");
    if (!row) return;
    showContextMenu(e, row);
    // e.preventDefault();  // ê¸°ë³¸ ë©”ë‰´ë„ ì“°ê³  ì‹¶ë‹¤ê³  í•´ì„œ ì•ˆ ë§‰ìŒ
});

/* ëª¨ë°”ì¼ â€“ ë¡±í”„ë ˆìŠ¤ ì‹œ ë©”ë‰´ ë„ìš°ê¸° */
if (isMobile) {
    let longPressTimer = null;
    table.addEventListener("touchstart", (e) => {
        const row = e.target.closest(".row.data-row");
        if (!row) return;
        longPressTimer = setTimeout(() => {
            showContextMenu(e, row);
        }, 600); // 0.6ì´ˆ ê¾¹ ëˆŒëŸ¬ì•¼ ë©”ë‰´
    });

    table.addEventListener("touchend", () => {
        if (longPressTimer) clearTimeout(longPressTimer);
    });
}

/* ë°”ê¹¥ ì•„ë¬´ë°ë‚˜ í´ë¦­í•˜ë©´ ë©”ë‰´ ë‹«ê¸° */
document.addEventListener("click", (e) => {
    if (e.target.closest(".context-menu")) return;
    document.querySelectorAll(".context-menu").forEach(el => el.remove());
});

/* ì´ˆê¸° í•œ ë²ˆ ìŠ¤íƒ€ì¼ ì ìš© */
refreshAllRows();
</script>

</body>
</html>
